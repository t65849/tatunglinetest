<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"></meta>
    <title>大世科PNP發送系統</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
</head>

<body>
    <p>手機號碼+886
        <!--<input id="phonenumber" type="text" value="+886912345678" placeholder="例如:+886912345678"></input>-->
        <input id="phonenumber" type="text" placeholder="例如:+886912345678"></input>
    </p>
    <form>選擇類型
        <select id="texttype" class="type" name="typemessages">
            <option id="text" value="text">Text訊息</option>
            <option id="flex" value="flex">Flex訊息</option>
        </select>
    </form>
    <p>傳送文字
        <input id="messages" type="text" value="傳送的文字訊息"></input>
    </p>
    <div>
        <p>輸入密碼:
            <input type="password" class="input" id="password">
        </p>
        <button type="button" onclick="phonenumberpush()">送出</button>
    </div>
    <!--<textarea id="textarea" rows="30" cols="100"></textarea>-->
</body>
<script type="text/javascript">
    var messages;
    $(document).ready(function () {
        $('#texttype').change(function () {
            if ($(this).val() == 'text') {
                messages = $('#messages').val();
            } else if ($(this).val() == 'flex') {
                messages = [
                    {
                        "type": "flex",
                        "altText": "this is a flex message",
                        "contents":
                        {
                            "type": "bubble",
                            "styles": {
                                "footer": {
                                    "separator": true
                                }
                            },
                            "body": {
                                "type": "box",
                                "layout": "vertical",
                                "contents": [
                                    {
                                        "type": "text",
                                        "text": "付款",
                                        "weight": "bold",
                                        "color": "#1DB446",
                                        "size": "sm"
                                    },
                                    {
                                        "type": "text",
                                        "text": "NT$ 54",
                                        "weight": "bold",
                                        "size": "xxl",
                                        "margin": "md"
                                    },
                                    {
                                        "type": "text",
                                        "text": "LINE PAY",
                                        "weight": "bold",
                                        "size": "md",
                                        "margin": "md"
                                    },
                                    {
                                        "type": "text",
                                        "text": today,
                                        "size": "xs",
                                        "color": "#aaaaaa",
                                        "wrap": true
                                    },
                                    {
                                        "type": "text",
                                        "text": "付款完成。",
                                        "weight": "bold",
                                        "size": "xl",
                                        "wrap": true
                                    },
                                    {
                                        "type": "separator",
                                        "margin": "xxl"
                                    },
                                    {
                                        "type": "box",
                                        "layout": "vertical",
                                        "margin": "xxl",
                                        "spacing": "sm",
                                        "contents": [
                                            {
                                                "type": "box",
                                                "layout": "horizontal",
                                                "contents": [
                                                    {
                                                        "type": "text",
                                                        "text": "商店名稱",
                                                        "size": "sm",
                                                        "color": "#555555",
                                                        "flex": 0
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": "全家便利商店",
                                                        "weight": "bold",
                                                        "size": "sm",
                                                        "color": "#111111",
                                                        "align": "end"
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "text",
                                                "text": "1",
                                                "weight": "bold",
                                                "size": "sm",
                                                "color": "#ffffff"
                                            },
                                            {
                                                "type": "text",
                                                "text": "指定消費為排除繳稅、超商、全聯、分期等無法回饋LINE Points點數的消費。【完整不回饋消費項目清單，請參閱下方連結】LINE Pay聯名卡2%點數回饋資格將依中國信託LINE Pay聯名卡回饋計畫為準。【謹慎理財信用至上】信用卡循環年利率=中國信託ARMs+5.97%起，上限15%",
                                                "size": "sm",
                                                "color": "#555555",
                                                "wrap": true
                                            }
                                        ]
                                    },
                                    {
                                        "type": "separator",
                                        "margin": "xxl"
                                    },
                                    {
                                        "type": "text",
                                        "text": "聯絡中國信託",
                                        "size": "xl",
                                        "color": "#000077",
                                        "wrap": true
                                    }
                                ]
                            }
                        }
                    }
                ]
            }
        });
    });
    function phonenumberpush() {
        var phonenumber = $('#phonenumber').val();
        //var messages = $('#messages').val();
        var password = $('#password').val();

        if (phonenumber.indexOf("+886") >= 0) {
            if (phonenumber.indexOf("0") == 4) {
                phonenumber = phonenumber.replace("+8860", "+886");
            }
        }
        else if (phonenumber.indexOf("886") >= 0) {
            if (phonenumber.indexOf("0") == 3) {
                phonenumber = phonenumber.replace("8860", "+886");
            }
            else {
                phonenumber = phonenumber.replace("886", "+886");
            }
        }
        else {
            if (phonenumber.indexOf("0") == 0) {
                phonenumber = phonenumber.replace("0", "+886");
            }
            else {
                phonenumber = phonenumber.replace("9", "+8869");
            }
        }
        var data = {
            password: password,
            phonenumber: phonenumber,
            messages: messages
        }
        $.post('/pnp/send/' + phonenumber + '/' + messages, data, function (response_data) {
            if (response_data == 'success') {
                alert('傳送成功');
                console.log(response_data);
            } else if (response_data == '密碼錯誤') {
                alert('密碼錯誤');
            } else {
                alert('傳送失敗');
                console.log(response_data);
            }
        });
    };
</script>

</html>